import Text "mo:base/Text";
import Char "mo:base/Char";
import Blob "mo:base/Blob";
import Principal "mo:base/Principal";
import Array "mo:base/Array";
import Buffer "mo:base/Buffer";
import Iter "mo:base/Iter";
import Nat8 "mo:base/Nat8";
import Nat16 "mo:base/Nat16";
import Nat32 "mo:base/Nat32";
import CertifiedData "mo:base/CertifiedData";
import CertTree "mo:ic-certification/CertTree";
import ReqData "mo:ic-certification/ReqData";
import CanisterSigs "mo:ic-certification/CanisterSigs";
import MerkleTree "mo:ic-certification/MerkleTree";
import Debug "mo:base/Debug";

import EncodingUtils "EncodingUtils";

module {

  public type HeaderField = (Text, Text);

  public type StreamingStrategy = {
    #Callback : {
      callback : StreamingCallback;
      token : StreamingCallbackToken;
    };
  };

  public type StreamingCallback = query (StreamingCallbackToken) -> async (StreamingCallbackResponse);

  public type StreamingCallbackToken = {
    content_encoding : Text;
    index : Nat;
    key : Text;
  };

  public type StreamingCallbackResponse = {
    body : Blob;
    token : ?StreamingCallbackToken;
  };

  public type Request = {
    body : Blob;
    headers : [HeaderField];
    method : Text;
    url : Text;
  };

  public type Response = {
    body : Blob;
    headers : [HeaderField];
    streaming_strategy : ?StreamingStrategy;
    status_code : Nat16;
  };

  // 200 OK response with picture
  public func httpImgResponse(pic : Blob, url : Text, ct : CertTree.Ops) : Response {
    {
      body = pic;
      headers = [
        ("Content-Type", getImageMimeType(decodeFileExtension(url))),
        ("Access-Control-Allow-Origin", "*"),
        createCertificationHeader(url, ct),
      ];
      status_code = 200;
      streaming_strategy = null;
    };
  };

  public func httpIcDomainsResponse(url : Text, ct : CertTree.Ops) : Response {
    {
      body = Text.encodeUtf8("img.nostric.app\nimg.dev.nostric.app");
      headers = [
        ("Content-Type", "application/octet-stream"),
        ("Access-Control-Allow-Origin", "*"),
        createCertificationHeader(url, ct),
      ];
      status_code = 200;
      streaming_strategy = null;
    };
  };

  // 404 Not Found response
  public func httpNotFoundResponse(msg : ?Text, url : Text, ct : CertTree.Ops) : Response {
    {
      body = Text.encodeUtf8(
        switch (msg) {
          case (?msg) msg;
          case null "Not found.";
        }
      );
      headers = [("Content-Type", "text/plain"), createCertificationHeader(url, ct)];
      status_code = 404;
      streaming_strategy = null;
    };
  };

  public func getFavicon() : Blob {
    let faviconBase64 = "AAABAAMAEBAAAAEAIABoBAAANgAAACAgAAABACAAKBEAAJ4EAAAwMAAAAQAgAGgmAADGFQAAKAAAABAAAAAgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAX3BZ4HuZmeR3tcnke7SoAAAAAAAAAAAAAAAAAAAAA46wpJeKsKXHhqyhn6bEsFwAAAAAAAAAAAAAAAHwgqkh8IMDxeh/W+Xke6vF5Hu78eB7tilUAqgP/AAAB4qope+KrKfrfqy31uKxd+b6sVvLhqyxMAAAAAIgidw+AIpLufSGpt3EcuBJmAMwFeR7udnkd7vt5Hu2g4qoqk+KrKf/jqyiS7bYkDjy0/xE6sPy0XK/Q8JyqjhKBJGtPgSR6/4AgjCgAAAAAAAAAAAAAAAB3Huxer2WI/uKrKf/iqid7AAAAAAAAAAAAAAAAPLT/Ijux/P48sflVhCdUT4MlY/+AJmwoAAAAAAAAAAAAAAAA46spduKrKf+JhYb+JFnyZAAAAAAAAAAAAAAAADSl+CI6r/z+PLH8VapmMw+XQkrtgyVeuYYoaxPYnScN4qspj+KsKf7iqymXJVrwmSNa8vwjWPF8KlX/BjCA/xAykPazN6H68Dmq/xIAAAAA36koR86NM/DJiDn64Kgr9eKrKfvhqSiA//8AAQCA/wIjWfCEJFry+yRd8fIobPP4LX328jKO9U0AAAAAAAAAAAAAAADnqiQV46spZOKsKXHkrigmAAAAAAAAAAAAAAAAAAAAACFc8ickWvFxJV/wZipq9BgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAACAAAABAAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8A/wEAAP8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB//8AAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";
    return EncodingUtils.decodeBase64(faviconBase64);
  };

  private func decodeFileExtension(url : Text) : Text {
    let filePathSplit = Iter.toArray(Text.split(url, #char '.'));
    if (Array.size(filePathSplit) != 2) {
      return "";
    };
    let attributeSplit = Iter.toArray(Text.split(filePathSplit[1], #char '?'));
    return "." # attributeSplit[0];
  };

  private func getImageMimeType(extension : Text) : Text {
    switch (extension) {
      case ".aac" { "audio/aac" };
      case ".abw" { "application/x-abiword" };
      case ".apng" { "image/apng" };
      case ".arc" { "application/x-freearc" };
      case ".avif" { "image/avif" };
      case ".bmp" { "image/bmp" };
      case ".gif" { "image/gif" };
      case ".ico" { "image/x-icon" };
      case ".jpg" { "image/jpeg" };
      case ".jpeg" { "image/jpeg" };
      case ".png" { "image/png" };
      case ".svg" { "image/svg+xml" };
      case "tif" { "image/tiff" };
      case ".tif" { "image/tiff" };
      case ".webp" { "image/webp" };
      case _ { "application/octet-stream" }; // Default MIME type for unknown extensions
    };
  };

  private func createCertificationHeader(url : Text, ct : CertTree.Ops) : HeaderField {
    if (ct.lookup(["http_assets", Text.encodeUtf8(url)]) == null) {
      return ("X-HTTP-Fallback", "true");
    };
    let witness = ct.reveal(["http_assets", Text.encodeUtf8(url)]);
    let encoded = ct.encodeWitness(witness);
    let cert = switch (CertifiedData.getCertificate()) {
      case (?c) c;
      case null {
        "getCertificate failed. Call this as a query call!" : Blob;
      };
    };
    let result : HeaderField = (
      "ic-certificate",
      "certificate=:" # EncodingUtils.encodeBase64(cert) # ":, " #
      "tree=:" # EncodingUtils.encodeBase64(encoded) # ":",
    );
    Debug.print(
      "certificate=:" # EncodingUtils.encodeBase64(cert) # ":, " #
      "tree=:" # EncodingUtils.encodeBase64(encoded) # ":"
    );
    return result;

  };
};
